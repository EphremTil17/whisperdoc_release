# WhisperDoc Technical Release Notes - v2.19.0
**Version Range: v2.13.0 to v2.19.0**

This release focuses on structural refinement through the "Smart" Modular Architecture migration, advanced service decomposition, and significant performance optimizations for both the Flutter client and the AI backend.

## Architectural Refinement

### "Smart" Modular Architecture Migration
- Completed a comprehensive structural overhaul of the Flutter client, enforcing strict physical boundaries between the Infrastructure, Service, Domain Logic, and Feature layers.
- Centralized system foundations including Dependency Injection, Theme tokens, and global Constants into a dedicated Infrastructure layer.
- Extracted pure functional processors and state mappers into the Domain Logic layer to completely decouple business rules from presentation logic.
- Reorganized the UI hierarchy into cohesive feature-based modules (e.g., Recording, Settings, ProfileHub), enhancing maintainability and testability.

### WebSocket Orchestrator Pattern
- Refactored the monolithic WebSocketService into a lightweight coordinator delegating specialized responsibilities to four internal sub-managers:
    - **AudioBufferManager**: Handles zero-loss chunk queuing during the critical handshake transition phase.
    - **ReconnectionManager**: Orchestrates complex retry sequences with an integrated security 'Kill Switch' for authentication failures.
    - **HeartbeatManager**: Manages idle timeouts and active connection health monitoring.
    - **ConfigurationManager**: Encapsulates OIDC and settings observation to trigger reactive state changes without service bloat.
- Fully implemented the OIDC silent refresh flow and automated session lifecycle management, instantiating handshakes immediately upon identity changes.

### Identity Layer Specialization
- Decomposed the monolithic AuthService into specialized managers: `OidcManager` for PKCE and OAuth2 protocol exchanges, and `SessionManager` for secure token persistence and JWT profile extraction.
- Developed the `HandshakePayloadBuilder` to standardize WebSocket metadata construction, correctly prioritizing OIDC tokens over static API keys.
- Implemented a modularized OIDC callback flow that dynamically loads a glassmorphic success landing page via the Flutter `rootBundle`.

## Backend Engineering & Performance

### Model Warmup & Non-Blocking Lifecycle
- Introduced predictive model warmup, triggered immediately after a successful authentication handshake to utilize idle time while the user prepares to record.
- Implemented threading locks and `asyncio.to_thread` for non-blocking model retrieval, ensuring the main event loop remains responsive during heavy GPU/CPU loading operations.
- Added environment variables for granular server-side tuning, including beam size, silence thresholds, and context conditioning.
- Developed probabilistic silence gating to selectively return empty transcriptions when no speech is detected, reducing unnecessary processing overhead.

### Infrastructure Optimization ("Digital Liposuction")
- Slashed the production Docker image size from 11.8GB to 7.35GB through aggressive pruning of `.a` and `__pycache__` files and switching to static FFmpeg binaries.
- Integrated `uvloop` for a high-performance C-based event loop and `orjson` for sub-millisecond JSON serialization.
- Hardened memory hygiene by implementing `malloc_trim` to force OS-level RAM reclamation immediately after model unloading.
- Implemented drift-proof security maintenance loops and granular configuration for `ALLOWED_ORIGINS` and `ALLOWED_HOSTS`.

## Hardware Integration & UX

### Native Win32 Audio Cues
- Introduced the `AudioCueService`, which utilizes the native Windows `PlaySound` API for near-zero latency audio feedback during recording state transitions.
- Chimes are preloaded into native memory to ensure instant response times, bypassing the latency over-head of standard Dart-based players.

### Enhanced User Experience
- Integrated descriptive tooltips across all action buttons in the ActionBar to provide immediate operational context.
- Refactored the Profile Hub with interactive hover effects and background expansion logic.
- Implemented robust "Auto-Connect on Launch" logic that proactively checks OIDC token availability to establish session state before user interaction.
- Hardened backend issuer validation with slash-agnostic comparison to normalize URL configuration mismatches.
