# WhisperDoc Technical Release Notes - v2.20.0
**Version Range: v2.19.0 to v2.20.0**

This release focuses on optimizing the update management lifecycle, standardizing protocol rejection mechanisms, and enhancing synchronized observability between the Flutter client and the AI backend. It introduces a throttled update strategy and modular state orchestration for user profiles.

## Backend Protocol & Security

### Standardized 1008 Rejection Pipeline
- Re-engineered the WebSocket rejection mechanism to ensure a JSON-formatted error event is transmitted before socket closure (Code 1008). This provides the client with explicit context (e.g., Ban durations, Max connections) for intelligent UI routing.
- Integrated the IP-governance and Active Defense Circuit Breaker directly into the new standardized rejection pipeline.

### Handshake Versioning Gate
- Implemented a hardened handshake versioning gate supporting both `MIN_CLIENT_VERSION` (enforced block) and `SEC_CLIENT_VERSION` (security advisory) logic.
- Added versioning requirement placeholders to `.env.template` to facilitate environment-specific enforcement.

### Enhanced Observability & CID Tracking
- Promoted WebSocket handshake logs to the `INFO` level, including real-time reporting of the client type (e.g., `flutter_windows`), client version, and authentication type.
- Exposed the Short Connection ID (CID) to the client hello message to enable matched logging between the client and server telemetry.

## Client Engineering & UI Refinement

### Throttled Update Management
- Developed the `UpdateService` featuring a rate-limited discovery strategy with a **6-hour cooldown** on GitHub API calls to prevent 403 Rate Limit errors.
- Implemented state-gated listeners that only trigger version re-evaluations when new backend handshake metadata arrives, significantly reducing idle CPU overhead and log noise.
- Introduced "Integrated Alert" logic: the client now proactively flags an "Update Available" status if the connected server is running a newer version than the client, even if not explicitly mandated by advisory requirements.

### Modular Profile Orchestration
- Extracted the `ProfileController` to decouple authentication management and update tracking from the presentation layer, adhering to the project's strict modularity constraints.
- Re-engineered the `ProfileHubDialog` into a lean, orchestration-only component, delegating UI responsibilities to atomic, reusable widgets:
    - **UpdateCard**: Displays context-aware version status with integrated download actions.
    - **ProfileInfoBlock**: Standardized user identity and session visualization.

### Intelligence Error Routing
- Centralized the `HomeScreen` error dispatcher to intelligently route backend rejections to specific UI flows:
    - **Ban Overlay**: Instant countdown visualization for IP-restricted users.
    - **Update SnackBar**: High-priority crimson notifications for critical version requirements.
    - **Auth Dialog**: Standard routing for session and credential failures.

## Performance & Stability
- Fixed a critical regression in the WebSocket idle timeout that caused frequent, unnecessary reconnection loops during inactivity.
- Optimized SnackBar notification durations to 1 second for a more responsive and less intrusive user experience.
- Synchronized CID logging: the Flutter client now logs its assigned 4-digit Connection ID upon successful handshake, providing a deterministic bridge for cross-stack debugging.
